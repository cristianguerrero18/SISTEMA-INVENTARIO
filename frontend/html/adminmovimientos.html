<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inventario | Usuarios</title>
    <script>
      // ðŸš¨ Ejecutar la validaciÃ³n inmediatamente
      const token = sessionStorage.getItem("token");
      const rol = sessionStorage.getItem("rol");

      if (!token || Number(rol) !== 1) {
        // Redirigir ANTES de renderizar nada
        window.location.replace("login.html");
      }
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/adminusers.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <button class="volver-btn" onclick="window.location.href='admin.html'">
          <i data-lucide="arrow-left"></i> Volver
        </button>
        <h2><i data-lucide="users"></i> Lista de Movimientos</h2>
      </div>

      <div class="actions-bar">
        <button class="btn-agregar" id="openModal">
          <i data-lucide="plus-circle"></i> Agregar Movimiento
        </button>

        <div class="search-box">
          <i data-lucide="search"></i>
          <input 
            type="text" 
            id="searchUser" 
            placeholder="Buscar movimiento por nombre o ID..."
          >
        </div>
      </div>
      
      <div class="tabla-contenedor">
        <table id="table-mov">
          <thead>
            <tr>
              <th><i data-lucide="hash"></i> ID</th>
              <th><i data-lucide="package"></i>Producto</th>
              <th><i data-lucide="tag"></i> Tipo</th>
              <th><i data-lucide="bar-chart"></i> Cantidad</th>
              <th><i data-lucide="calendar"></i> Fecha</th>
              <th><i data-lucide="eye"></i>Observacion</th>
              <th><i data-lucide="user"></i>Usuario</th>
              <th><i data-lucide="settings"></i> Acciones</th>
            </tr>
          </thead>
          <tbody>
            <!--se llena automaticamente-->
          </tbody>
        </table>
      </div>
      </div>
    </div>

    <div class="modal" id="userModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i data-lucide="user-plus"></i> Nuevo Movimiento</h3>
          <span class="close" id="closeModal">&times;</span>
        </div>
        <form>
          <label for="producto">Producto</label>
          <select required id="producto"></select>
          <label for="tipo">Tipo</label>
          <select required id="tipo">
            <option value="">Seleccione</option>
            <option value="Entrada">Entrada</option>
            <option value="Salida">Salida</option>
            <option value="Baja">Baja</option>
          </select>
          <label for="cantidad">Cantidad</label>
          <input required id="cantidad" type="text" />
          <label for="observacion">Observacion</label>
          <input type="text" required id="observacion" />
          

          <button type="submit" id="btn-guardar">
            <i data-lucide="save"></i> Guardar
          </button>
        </form>
      </div>
    </div>

    <!--formulario de editar-->

    <div class="modal" id="editUserModal">
      <div class="modal-content-producto">
        <div class="modal-header">
          <h3><i data-lucide="user-cog"></i> Editar Producto</h3>
          <span class="close" id="closeEditModal">&times;</span>
        </div>
        <form>
          <!-- Campo oculto para guardar el ID del usuario -->
          <label for="edit-id">ID</label>
          <input type="text" id="edit-id" readonly /> 
          <label for="edit-producto">Producto</label>
          <select required id="edit-producto"></select>
          <label for="edit-tipo">Tipo</label>
          <input type="text" readonly id="edit-tipo">
          <label for="edit-cantidad">Cantidad</label>
          <input type="text" id="edit-cantidad" required>
          <label for="edit-observacion">Observacion</label>
          <input
            required
            id="edit-observacion"
          />
          <button type="submit" id="btn-actualizar">
            <i data-lucide="save"></i> Actualizar
          </button>
        </form>
      </div>
    </div>
  </div>

    <script>
      lucide.createIcons();

      const modal = document.getElementById("userModal");
      const openModal = document.getElementById("openModal");
      const closeModal = document.getElementById("closeModal");

      openModal.addEventListener("click", () => (modal.style.display = "flex"));
      closeModal.addEventListener(
        "click",
        () => (modal.style.display = "none")
      );
      window.addEventListener("click", (e) => {
        if (e.target === modal) modal.style.display = "none";
      });
    </script>
    <script type="module" src="../js/movimientos.js"></script>
  </body>
</html>